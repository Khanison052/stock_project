<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate QR Code</title>
</head>
<body>
    <h2>à¸ªà¸£à¹‰à¸²à¸‡ QR Code à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¸´à¸™à¸„à¹‰à¸²</h2>
    
    <label>à¸£à¸«à¸±à¸ªà¸ªà¸´à¸™à¸„à¹‰à¸²:</label>
    <input type="text" id="codeproduct"><br><br>

    <label>à¸Šà¸·à¹ˆà¸­à¸ªà¸´à¸™à¸„à¹‰à¸²:</label>
    <input type="text" id="name"><br><br>

    <label>à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆ:</label>
    <input type="text" id="category"><br><br>

    <label>à¸£à¸²à¸„à¸²:</label>
    <input type="number" id="price"><br><br>

    <label>à¸§à¸±à¸™à¸—à¸µà¹ˆ:</label>
    <input type="date" id="date"><br><br>

    <button onclick="generateQR()">à¸ªà¸£à¹‰à¸²à¸‡ QR Code</button>
    <br><br>
    
    <img id="qrImage" src="" style="display: none;">
    <br>
    <a id="downloadBtn" style="display: none;" onclick="downloadQR()">ðŸ“¥ à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸” QR Code</a>
    <button id="printBtn" style="display: none;" onclick="printQR()">ðŸ–¨ à¸žà¸´à¸¡à¸žà¹Œ QR Code</button>

    <script>
        function generateQR() {
            const codeproduct = document.getElementById("codeproduct").value.trim();
            const name = document.getElementById("name").value.trim();
            const category = document.getElementById("category").value.trim();
            const price = document.getElementById("price").value.trim();
            const date = document.getElementById("date").value.trim();

            if (!codeproduct || !name || !category || !price || !date) {
                alert("à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¹‰à¸„à¸£à¸šà¸—à¸¸à¸à¸Šà¹ˆà¸­à¸‡");
                return;
            }

            const productData = { codeproduct, name, category, price, date };

            fetch("http://127.0.0.1:5000/generate_qr", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(productData)
            })
            .then(response => response.blob())
            .then(blob => {
                const imgUrl = URL.createObjectURL(blob);
                document.getElementById("qrImage").src = imgUrl;
                document.getElementById("qrImage").style.display = "block";

                // à¹€à¸›à¸´à¸”à¸›à¸¸à¹ˆà¸¡à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¹à¸¥à¸°à¸›à¸£à¸´à¹‰à¸™ QR Code
                document.getElementById("downloadBtn").style.display = "block";
                document.getElementById("downloadBtn").href = imgUrl;
                document.getElementById("downloadBtn").download = "qrcode.png";

                document.getElementById("printBtn").style.display = "block";
            })
            .catch(error => console.error("Error:", error));
        }

        function downloadQR() {
            const link = document.createElement("a");
            link.href = document.getElementById("qrImage").src;
            link.download = "qrcode.png";
            link.click();
        }

        function printQR() {
            const qrWindow = window.open("");
            qrWindow.document.write("<html><head><title>Print QR Code</title></head><body>");
            qrWindow.document.write("<img src='" + document.getElementById("qrImage").src + "' width='300'>");
            qrWindow.document.write("</body></html>");
            qrWindow.document.close();
            qrWindow.print();
        }
    </script>
</body>
</html>
